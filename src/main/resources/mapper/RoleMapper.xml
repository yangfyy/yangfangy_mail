<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.springboot.mapper.RoleMapper">

    <select id="findById" resultMap="roleMap">
        SELECT * FROM sys_role  WHERE 1=1
        <if test="id != null and id != ''">
            AND  rid=#{id}
        </if>
    </select>
    <select id="findAll" resultMap="roleMap">
        SELECT  * FROM sys_role WHERE 1=1
    </select>
    <resultMap id="roleMap" type="com.springboot.entity.Role">
        <id property="id" column="rid" jdbcType="VARCHAR" />
        <result property="available" column="available" jdbcType="VARCHAR"/>
        <result property="description" column="description" jdbcType="VARCHAR"/>
        <result property="role" column="role" jdbcType="VARCHAR"/>
        <collection property="permissions" column="rid"  javaType="list"  select="selectPerssionMapByRoleId"/>
    </resultMap>

    <select id="selectPerssionMapByRoleId" resultMap="permissionMap">
        SELECT  p1.id AS id ,p1.permission AS permission FROM sys_permission p1  LEFT JOIN sys_role_permission p2 ON p1.id = p2.permission_id
        LEFT JOIN sys_role p3 ON p2.`role_id`=p3.`rid` WHERE
        p3.`rid`=#{roleId}
    </select>

    <resultMap id="permissionMap" type="com.springboot.entity.Permission">
        <id property="id" column="id" jdbcType="VARCHAR"/>
        <result property="available" column="available" jdbcType="VARCHAR"/>
        <result property="name" column="name" jdbcType="VARCHAR"/>
        <result property="parentId" column="parent_id" jdbcType="VARCHAR"/>
        <result property="parentIds" column="parent_ids" jdbcType="VARCHAR"/>
        <result property="permission" column="permission" jdbcType="VARCHAR"/>
        <result property="resource_type" column="resourceType" jdbcType="VARCHAR"/>
        <result property="url" column="url"/>
    </resultMap>
</mapper>